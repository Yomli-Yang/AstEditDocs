# AstEdit 基本操作及参数说明

`版本: v1.0.0 beta`

## 前言

 第一版制谱器任由许多功能未开发完毕并且诸多方面不够完善，难免遇到许多Bug，功能不理想，使用还不便捷。所以有任何问题，建议或遇到 Bug 时，请一定要及时反馈给我 `Yomli (ヨムリ)`。

## 开始

### 下载安装 AstEdit

#### 下载

下载群内 `制谱器` 文件夹中最新版本制谱器压缩包（AstEdit-x.x.x.zip）。

#### 安装

#### 本体

解压下载的制谱器压缩包至任意路径下（不建议`C盘和桌面`）。

#### 运行环境（如可正常运行则忽略）

##### 浏览器

​		建议使用 `Chrome` 或 `Edge` 的较新版本，其它浏览器任意出现兼容或未预料的问题，千万别用 ==***IE***==。

##### 检查运行环境（不知道是否已安装运行环境请如下操作）

按下 `win + r` ，在弹出来的窗口中输入 `cmd` 并回车确定。

<img src="D:\code_doc\AstEdit\image-20221202223807867.png" alt="image-20221202223807867" style="zoom: 80%;" />

在弹出的窗口中输入 `node -v`, 回车，如果显示的版本号是 `v14.15.0` 及以上则无需安装运行环境，否则（包含结果不是版本号）需要安装运行环境。

![image-20221202223952999](D:\code_doc\AstEdit\image-20221202223952999.png)

---

##### 安装运行环境

[在 Node.js 官网（点击跳转）](https://nodejs.org/zh-cn/download/)下载 `14.15.0` 及以上版本的 Node.js 。

怕下载慢来这个网址: [Node.js 中文站](http://nodejs.cn/download/)

选择与自己电脑相匹配的安装包版本下载。

​	<img src="D:\code_doc\AstEdit\image-20221202225423746.png" alt="image-20221202225423746" style="zoom: 67%;" />

1. 运行下载的安装包，等待 `next` 按钮可点击后点击

2. 下一页勾选同意协议然后点击 `next`。
3. 选择安装路径后点击 `next`。
4. 一直点击 `next` 直到安装完毕。

<img src="D:\code_doc\AstEdit\image-20221202230056320.png" alt="image-20221202230056320" style="zoom:50%;" />

##### 配置环境变量

1. 安装完毕后回到第一步 `检查安装环境`，如果任不显示版本号或版本号低于14.15.0则进行以下操作。

右键桌面的 `我的电脑（计算机）`，点击 `属性`。

<img src="D:\code_doc\AstEdit\image-20221202230728487.png" alt="image-20221202230728487" style="zoom: 67%;" />

2. Win10及以上滑到底部，Win7在左侧，点击 `高级系统设置`。<img src="D:\code_doc\AstEdit\image-20221202230916266.png" alt="image-20221202230916266" style="zoom: 50%;" />

3. 点击右下 `环境变量`。

<img src="D:\code_doc\AstEdit\image-20221202231321560.png" alt="image-20221202231321560" style="zoom:50%;" />

4. 在系统变量中找到 `Path`并编辑。

    <img src="D:\code_doc\AstEdit\image-20221202231507882.png" alt="image-20221202231507882" style="zoom:67%;" />

    

5. 添加 `Node.js` 的安装路径至 `Path` 中，添加后应如下图（路径不一定一样），然后点击确定后再次回到`检查运行环境`检查，如仍未成功请检查是否正确配置环境变量。（Win7是一个非常不人性的输入框，在已有内容后添加 `,Node.js的安装路径`即可。）

    <img src="D:\code_doc\AstEdit\image-20221202232258847.png" alt="image-20221202232258847" style="zoom:67%;" />

---

##### 为什么要下载 Node.js ?

​		`Node.js` 是一个强大、著名的 `Javascript` 运行时环境，制谱器的运行及其中文件等操作仅凭浏览器无法实现，需要依赖 `Node.js` 。

##### 关于 Node.js 安全性

​		`Node.js` 是一个十分成熟并且开源的技术，许多知名应用中都有它的身影，例如：Photoshop, Discord,  钉钉, VS Code, WallPaper, OBS。所以 `Node.js` 的安全性母庸质疑。

---

### 界面

![image-20221202211728108](D:\code_doc\AstEdit\image-20221202211728108.png)

---

### 术语定义

> #### Fraction Beat

拍子的 `带分数` 表示方法。表示为 `a b/c` 或 `a` 的形式，一般写作 $a\frac{b}{c}$，但是这样不方便编辑。`a` 为 `整数` （可为 `负数`），空格后接分数 `b/c`。

简称：FB

例：3.5 可表示为 `3 1/2`。

> #### 事件

编辑区中所有课编辑的内容统称为 `事件`。

> #### 事件区

编辑区中各类事件编辑的区域叫做 `事件区`，通常具有不同的颜色底板。

---

### 音频

打开制谱器后是一个空谱面，需选择音频或打开谱面工程文件（工程文件会存储音频文件的哈希值，如果制谱器资源文件中有对应音频会自动使用）。

加载完毕后可通过 `空格` 控制音频播放。

点击音频右侧更多按钮可调整播放速度（![image-20221202214007831](D:\code_doc\AstEdit\image-20221202214007831.png))，暂无快捷键，后面会加（如果调速用不了请使用Chrome或Edge，这两个浏览器也用不了请升级浏览器)

- 注意：预览功能只支持OGG格式，详见`预览器`。

---

### 设置BPM

1. 在左侧工具栏里点击 `谱面信息` 板块（![image-20221202210339897](D:\code_doc\AstEdit\image-20221202210339897.png)），展开二级菜单（点击左上 ![image-20221202210346206](D:\code_doc\AstEdit\image-20221202210346206.png) 按钮)，在 `信息栏` 的 `BPM卡片` 中可对BPM进行编辑。

2. 修改 `BPM节` 时具体参数如下填写：

    BPM：BPM值 这个不用我说了吧

    开始时间：

- 注意：修改 `任意一节BPM节` 之后会重排所有 `BPM节` 开始时间对应的拍子数为原拍子数对应的时间。（我知道看不懂但我真不知道咋说[doge]）

---

### 调整延迟

切换快捷工具至第二组（![image-20221202212816660](D:\code_doc\AstEdit\image-20221202212816660.png))， 调整修改延迟，延迟单位为 `ms`。

---

### 事件の编辑

选择工具栏中 `编辑`工具（![image-20221202210431737](D:\code_doc\AstEdit\image-20221202210431737.png)) 然后可以在编辑区的 `各事件区` 编辑。（事件区详见下文)

#### 添加

##### Note 事件

- 选择 `Tap、Drag、Hold、Flick` 工具时，鼠标点击编辑区可添加对应类型Note，对齐参考线开启会时会自动吸附参考线。

- `Hold` 类型 Note 第一次点击编辑区没有反馈是正常的，第二次点击时才会添加。（反馈后面版本会加入）

- 通过快捷键 `Q, W, E, R, D或Delete` 可快速切换对应工具并进入编辑模式。

    - |   快捷键    | 对应工具 |
        | :---------: | :------: |
        |      Q      |   Tap    |
        |      W      |   Drag   |
        |      E      |  Flick   |
        |      R      |   Hold   |
        | D 或 Delete |   删除   |

- 注：note重叠显示问题后面版本会解决，拖动移动、批量编辑 后续加入。

##### 其它事件

- 选择 `Event` 工具时（除 `删除` 工具，选择其它工具时会自动改为 `Event` ），鼠标点击编辑区可添加对应事件，对齐参考线开启会时会自动吸附参考线。

#### 编辑

非 `删除` 工具时，左键单击编辑区的 `Note或事件` 会在信息区显示相关属性。

- Note 事件属性

    - LineId：Note所属线的ID。

    - 打击时间-TapTime：Note 的 `打击时间（判定时间）`， 写作 `FB` 形式。（此值 `不可小于` 该线第一个 `Dot` 的时间）

    - 类型-Type：Note 的 `类型`，总共有 `4种`——$Tap^0$、$Drag^2$、$Hold^1$、$Flick^3$。

    - 持续时间-Duration：Note 的 `持续时间`，仅类型为 `Hold` 时生效，写作 `FB` 形式，值必须 `大于 0`。（后续可以根据偏好在设置改为结束时间，结束时间必须 `大于` `打击时间`）

    - 方向-Direction：Note 的 `方向`，仅类型为 `Flick` 时生效，`0~7` `顺时针` 对应 `8 个方向`。

        <img src="D:\code_doc\AstEdit\image-20221203004409171.png" alt="image-20221203004409171" style="zoom:50%;" />

    ---

- Dot 事件属性

    - 位置-Position：Dot `相对`于父线的 `X坐标`，例如父线的 StartX 为 2, 当此值为 3 时，Dot 的全局坐标为 $2 + 3 = 5$。
    - 时间-Time：Dot 到达 `落点（判定点）` 的时间（第一个点就是线的端点，线会从此 Dot 显示），写作 `FB` 形式，`不可为负值`。
    - 缓动-ease：控制线形状的缓动函数，`0` 为`无缓动`，缓动为 `1~30`，第一个 Dot 设置任何值都一样，[缓动参考](https://easings.net/zh-cn)。

    ---

- Move 事件属性

    - From：`事件所属线` 移动事件的 `起始坐标`，会 `代替` 线的 `初始坐标`。
        - x：事件所属线的 `起始 X 坐标`（全局坐标）。
        - y：事件所属线的 `起始 Y 坐标`（全局坐标）。
    - to：`事件所属线` 移动事件的 `结束坐标`。
        - x：事件所属线的 `结束 X 坐标`（全局坐标）。
        - y：事件所属线的 `结束 Y 坐标`（全局坐标）。
    - 持续时间-Duration：事件持续时间，写作 `FB` 形式，`不可为负值`。（后续可在设置根据偏好改为结束时间，值需大于 `Time` 属性）
    - 缓动-ease：缓动函数，`0` 为`无缓动`，缓动为 `1~30`，[缓动参考](https://easings.net/zh-cn)。
    - 时间-Time：事件的开始时间，写作 `FB` 形式，不可为负值。

    ---

- Color 事件属性（未确定属性，暂不可用）

    - From：`事件所属线` 颜色事件的 `起始颜色`。
    - to：`事件所属线` 颜色事件的 `结束颜色`。
    - 持续时间-Duration：事件持续时间，写作 `FB` 形式，`不可为负值`。（后续可在设置根据偏好改为结束时间，值需大于 `Time` 属性）
    - 缓动-ease：缓动函数，`0` 为`无缓动`，缓动为 `1~30`，[缓动参考](https://easings.net/zh-cn)。
    - 时间-Time：事件的开始时间，写作 `FB` 形式，不可为负值。

    ---

- Rotate 事件属性

    - From：`事件所属线` 旋转事件的 `起始角度`（0~360）。
    - to：`事件所属线` 旋转事件的 `结束角度`（0~360）。
    - 持续时间-Duration：事件持续时间，写作 `FB` 形式，`不可为负值`。（后续可在设置根据偏好改为结束时间，值需大于 `Time` 属性）
    - 缓动-ease：缓动函数，`0` 为`无缓动`，缓动为 `1~30`，[缓动参考](https://easings.net/zh-cn)。
    - 时间-Time：事件的开始时间，写作 `FB` 形式，不可为负值。

    ------

- Timings 事件属性

    - SpeedRatio：事件所属线的 `改变后的流速`。

    - 时间-Time：事件的开始时间，写作 `FB` 形式，不可为负值。

---

#### 删除

选择 `删除` 工具后点击事件即可删除，或在任意工具下`右键`要删除的事件即可删除，工具快捷键：`D或Delete`。

---

### 线的参数

- ID: 线的 `ID`，添加或删除线后制谱器会自动调整所有线及相关事件的线 ID。

- 初始流速-Speed：线的 `初始流速`（玩家可以调整全局流速，所以一般不要太大哦（最好谱师间有一个标准流速区间））。 

- 初始X-StartX：线的 `初始X坐标`（全局坐标），会影响 `Dot 事件`。
- 初始Y-StartY：线的 `初始Y坐标`（全局坐标）。

---

### 历史记录

可通过`撤回`和`恢复`按钮（![image-20221203012913277](D:\code_doc\AstEdit\image-20221203012913277.png))撤销或恢复操作（当前版本仅支持事件)。

撤销快捷键：`ctrl + z`。

恢复快捷键: `ctrl + y` 或 `ztrl + shift + z`。

---

### 关于预览器

目前暂时使用的是由游戏本体打包出来的预览器，仅支持OGG音频格式，所以仅使用OGG格式的音频时可以预览。

预览功能后续制谱器会内置，到时候就会更方便了。

点击左上控制栏`连接按钮`（![image-20221203012552972](D:\code_doc\AstEdit\image-20221203012552972.png))可连接预览器，连接成功后可点击`预览按钮`（还没图标，估计会是▶)进行预览，会自动将当前谱面传输至预览器并从当前位置开始预览。